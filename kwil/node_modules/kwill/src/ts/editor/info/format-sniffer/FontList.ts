import * as log from 'loglevel';
import * as _ from 'lodash';
import {getAllTextEditors, getTextEditor, TextEditor} from '../../TextEditor';


/**
 * get the list of fonts used in an editor instance
 * @param id
 * @returns {string[]}
 */
export function getFontList(id: string) : string[]
{
    let children: Element[];

    //  get all nodes within the editable content

    children = _.toArray(getTextEditor(id).element.getElementsByTagName("*"));

    //  remove all non-font nodes

    _.remove(children, (child: Element) => child.tagName.toLowerCase() !== 'font');

    //  map the array of font nodes, plucking the font attribute from each one, and remove any duplicates

    return _.uniq(_.map(children, (child: Element) => child.getAttribute('face')));
}


/**
 * get a list of fonts used in all active editors
 * @return {string[]}
 */
export function getAllFonts() : string[]
{
    let fontLists: string[];

    //  retrieve the list of fonts for each instance in turn

    fontLists = _.flatMap(getAllTextEditors(), (instance: TextEditor, instanceID: string) => getFontList(instanceID));

    //  flatten the list of fonts, remove any duplicates/empty items and return

    return _.compact(_.uniq(fontLists));
}