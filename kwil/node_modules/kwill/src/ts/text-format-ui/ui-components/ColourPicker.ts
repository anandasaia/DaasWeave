import * as log from 'loglevel';
import {KWILL_CONSTS} from '../../constants/Constants';
import {formatText} from '../../editor/text-format/FormatText';
import {createColourPicker, IKulrInstance, IKulrOptions} from 'kulr';
import {IKwillInstanceOptions} from "../../editor/createKwillEditor";

/**
 * set up a colour picker
 * @param frame
 * @param options
 */
export function setupColourPicker(frame: HTMLIFrameElement, options: IKwillInstanceOptions) : IKulrInstance
{
    //  set colour picker options

    const colourPickerOptions: IKulrOptions =
        {
            id: options.id + '-colour-picker',
            elements:
                {
                    selector: <HTMLElement>frame.contentDocument.querySelector('.colour-picker')
                },
            actions:
                {
                    liveUpdate: false
                },
            defaultColour: 'aaaaaa'
        };

    //  create the colour picker

    try
    {
        const colourPicker: IKulrInstance = createColourPicker(colourPickerOptions);

        //  if we can't create the colour picker for any reason then stop here

        if ( ! colourPicker) return;

        //  subscribe to the colour picker's observable

        colourPicker.observableColour.subscribe(hex => formatText(KWILL_CONSTS.textFormats.TEXT_COLOUR, hex));

        //  return the new colour picker

        return colourPicker;
    }
    catch(e)
    {
        log.warn("can't create colour picker");
    }
}