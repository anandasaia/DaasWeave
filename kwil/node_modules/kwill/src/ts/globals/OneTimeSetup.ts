import * as log from 'loglevel';
import {getLogger} from "./Logging";
import {addGlobalListeners, removeGlobalListeners} from './GlobalInteractions';
import {IKwillInstanceOptions} from "../editor/createKwillEditor";

var isSetup: boolean;


/**
 * do any one-time init
 * @param options
 */
export function oneTimeSetup(options: IKwillInstanceOptions)
{
    //  have we already done the one-time init? don't do it again if so

    if (isSetup) return;

    //  set logging level

    getLogger().setLevel(getLogLevel(options));

    //  add global kwill listeners

    addGlobalListeners();

    //  flag that we've done our set up

    isSetup = true;
}


/**
 * get the logging level
 * @param options
 */
function getLogLevel(options: IKwillInstanceOptions)
{
    try
    {
        return options.config.debug === true ? LogLevel.TRACE : LogLevel.SILENT;
    }
    catch(e)
    {
        return LogLevel.SILENT;
    }
}


/**
 * break down our one-time stuff
 */
export function destroyOneTimeSetup()
{
    //  remove global listeners

    removeGlobalListeners();

    //  remove setup flag

    isSetup = false;
}