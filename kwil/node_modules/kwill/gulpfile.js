const gulp = require('gulp'),
    ts = require('gulp-typescript'),
    babel = require('gulp-babel'),
    merge = require('merge2');

//  build the project into lib format

var tsProject = ts.createProject('tsconfig.json');

//  compile typescript into multiple JS files in the /lib folder;
//  these compiled files can be imported as needed by modules

gulp.task('build', function ()
{
    //  define inputs: use typescript/tsx files, but ignore tests

    var tsResult = gulp.src(['./**/*.{ts,tsx}', '!./**/*.test.ts'], { cwd: './src/ts' })
        .pipe(tsProject());

    return merge([
        tsResult.dts.pipe(gulp.dest('lib')),
        tsResult.js
            .pipe(babel({ presets: ['es2015'] }))
            .pipe(gulp.dest('lib'))
    ]);
});